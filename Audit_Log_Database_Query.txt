-- AEGIS MASTER SCHEMA v4.5

-- 1. Users & Clients Table
CREATE TABLE users (
    user_id SERIAL PRIMARY KEY,
    email TEXT UNIQUE NOT NULL,
    password_hash TEXT NOT NULL,
    organization_name TEXT NOT NULL,
    role TEXT DEFAULT 'CLIENT', -- 'CLIENT' or 'SUPER_ADMIN'
    created_at TIMESTAMP DEFAULT NOW(),
	accepted_terms BOOLEAN DEFAULT FALSE,
	terms_accepted_at TIMESTAMP,
	is_verified BOOLEAN DEFAULT FALSE,
	verification_token TEXT
);

-- 2. Multi-Tenant Audit Logs
CREATE TABLE audit_logs (
    log_id SERIAL PRIMARY KEY,
    user_id INT REFERENCES users(user_id) ON DELETE CASCADE,
    target_db TEXT NOT NULL,
    target_table TEXT NOT NULL,
    target_pk_id TEXT NOT NULL, -- Changed to TEXT to support UUIDs/Emails/Ints
    executed_at TIMESTAMP DEFAULT NOW(),
    status TEXT NOT NULL -- 'SUCCESS', 'FAILED'
);